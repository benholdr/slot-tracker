<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SlotPro v2.0 - Machine Tracker</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM (UMD) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX parsing -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chart.js date adapter -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .chart-container { position: relative; height: 350px; width: 100%; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;
        
        const Icon = ({ name, size = 20, className = "" }) => {
            const icons = {
                PlusCircle: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="M12 8v8"/><path d="M8 12h8"/></svg>,
                Smartphone: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="14" height="20" x="5" y="2" rx="2" ry="2"/><path d="M12 18h.01"/></svg>,
                History: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></svg>,
                LayoutDashboard: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>,
                Trash2: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>,
                MapPin: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>,
                BarChart3: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="18" x2="18" y1="20" y2="10"/><line x1="12" x2="12" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="14"/></svg>,
                Filter: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>
            };
            return icons[name] || null;
        };

        const App = () => {
            const DAYS = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const DENOMS = ['.01', '.02', '.05', '.1', '.25', '.5', '1.00'];
            const MULTIPLIERS = ['1', '2', '3', '4', '5'];
            const COLORS = ['#4F46E5', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6', '#EC4899', '#06B6D4'];

            const [machines, setMachines] = useState(() => {
                const saved = localStorage.getItem('slot_tracker_machines');
                return saved ? JSON.parse(saved) : [];
            });

            const [records, setRecords] = useState(() => {
                const saved = localStorage.getItem('slot_tracker_records');
                return saved ? JSON.parse(saved) : [];
            });

            const [activeTab, setActiveTab] = useState('dashboard');
            const [filterDate, setFilterDate] = useState('');
            
            const [machineForm, setMachineForm] = useState({ name: '', location: '' });
            const [recordForm, setRecordForm] = useState({ 
                machineId: '', 
                day: DAYS[new Date().getDay()],
                totalBet: '',
                denom: '.01',
                multiplier: '1',
                jackpot: '',
                payoutTime: new Date().toISOString().slice(0, 16)
            });

            const chartRef = useRef(null);
            const chartInstance = useRef(null);

            useEffect(() => {
                localStorage.setItem('slot_tracker_machines', JSON.stringify(machines));
                localStorage.setItem('slot_tracker_records', JSON.stringify(records));
            }, [machines, records]);

            // Filtered records for stats and chart
            const filteredRecords = useMemo(() => {
                if (!filterDate) return records;
                return records.filter(r => r.displayDateISO === filterDate);
            }, [records, filterDate]);

            // Chart Rendering Logic
            useEffect(() => {
                if (activeTab === 'dashboard' && chartRef.current) {
                    const ctx = chartRef.current.getContext('2d');
                    
                    // Group data by machine for line series
                    const datasets = machines.map((m, index) => {
                        const machineData = filteredRecords
                            .filter(r => r.machineId === m.id)
                            .map(r => ({ x: r.timestamp, y: r.jackpot }))
                            .sort((a, b) => a.x - b.x);

                        return {
                            label: m.name,
                            data: machineData,
                            borderColor: COLORS[index % COLORS.length],
                            backgroundColor: COLORS[index % COLORS.length],
                            tension: 0.3,
                            pointRadius: 5,
                            pointHoverRadius: 8
                        };
                    }).filter(ds => ds.data.length > 0);

                    if (chartInstance.current) {
                        chartInstance.current.destroy();
                    }

                    chartInstance.current = new Chart(ctx, {
                        type: 'line',
                        data: { datasets },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { 
                                    position: 'bottom',
                                    labels: { font: { weight: 'bold', size: 11 } }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: (context) => `${context.dataset.label}: $${context.parsed.y.toFixed(2)}`
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: { color: '#F1F5F9' },
                                    ticks: { font: { weight: 'bold' }, callback: (value) => '$' + value }
                                },
                                x: {
                                    type: 'time',
                                    time: {
                                        unit: filterDate ? 'hour' : 'day',
                                        displayFormats: {
                                            hour: 'HH:mm',
                                            day: 'MMM d'
                                        }
                                    },
                                    grid: { display: false },
                                    ticks: { font: { weight: 'bold' } }
                                }
                            }
                        }
                    });
                }
                return () => {
                    if (chartInstance.current) chartInstance.current.destroy();
                };
            }, [activeTab, filteredRecords, filterDate, machines]);

            const addMachine = (e) => {
                e.preventDefault();
                if (!machineForm.name) return;
                const newMachine = { ...machineForm, id: self.crypto.randomUUID() };
                setMachines([...machines, newMachine]);
                setMachineForm({ name: '', location: '' });
            };

            const deleteMachine = (id) => {
                if (window.confirm('Delete machine?')) {
                    setMachines(machines.filter(m => m.id !== id));
                }
            };

            const addRecord = (e) => {
                e.preventDefault();
                if (!recordForm.machineId || !recordForm.totalBet) return;
                const machine = machines.find(m => m.id === recordForm.machineId);
                const payoutDate = new Date(recordForm.payoutTime);
                const newRecord = {
                    id: self.crypto.randomUUID(),
                    machineId: recordForm.machineId,
                    machineName: machine?.name || 'Unknown',
                    day: recordForm.day,
                    totalBet: parseFloat(recordForm.totalBet) || 0,
                    denom: recordForm.denom,
                    multiplier: recordForm.multiplier,
                    jackpot: parseFloat(recordForm.jackpot) || 0,
                    timestamp: payoutDate.getTime(),
                    displayTime: payoutDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                    displayDate: payoutDate.toLocaleDateString(),
                    displayDateISO: payoutDate.toISOString().split('T')[0] // For filtering
                };
                setRecords([newRecord, ...records]);
                setRecordForm({ ...recordForm, totalBet: '', jackpot: '' });
            };

            const deleteRecord = (id) => {
                if (window.confirm('Delete record?')) {
                    setRecords(records.filter(r => r.id !== id));
                }
            };

            const clearAllRecords = () => {
                if (window.confirm('Permanently delete all session records?')) {
                    setRecords([]);
                }
            };

            const stats = useMemo(() => {
                const totalPlayed = filteredRecords.reduce((acc, r) => acc + r.totalBet, 0);
                const totalJackpots = filteredRecords.reduce((acc, r) => acc + r.jackpot, 0);
                const avgJackpot = filteredRecords.length > 0 ? (totalJackpots / filteredRecords.length) : 0;
                return { totalPlayed, totalJackpots, avgJackpot, totalEntries: filteredRecords.length };
            }, [filteredRecords]);

            return (
                <div className="min-h-screen bg-[#F1F5F9] text-slate-900 pb-24 font-sans">
                    <nav className="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 flex justify-around p-3 z-50 md:hidden shadow-lg">
                        <button onClick={() => setActiveTab('dashboard')} className={`flex flex-col items-center ${activeTab === 'dashboard' ? 'text-indigo-600' : 'text-slate-400'}`}>
                            <Icon name="LayoutDashboard" size={20} />
                            <span className="text-[10px] mt-1 font-bold">Stats</span>
                        </button>
                        <button onClick={() => setActiveTab('machines')} className={`flex flex-col items-center ${activeTab === 'machines' ? 'text-indigo-600' : 'text-slate-400'}`}>
                            <Icon name="Smartphone" size={20} />
                            <span className="text-[10px] mt-1 font-bold">Machines</span>
                        </button>
                        <button onClick={() => setActiveTab('history')} className={`flex flex-col items-center ${activeTab === 'history' ? 'text-indigo-600' : 'text-slate-400'}`}>
                            <Icon name="History" size={20} />
                            <span className="text-[10px] mt-1 font-bold">History</span>
                        </button>
                    </nav>

                    <div className="max-w-6xl mx-auto p-4 md:p-8">
                        <div className="flex flex-col md:flex-row md:justify-between md:items-end mb-8 gap-4">
                            <div>
                                <h1 className="text-3xl font-black text-slate-900 flex items-center gap-2">
                                    SlotPro <span className="bg-indigo-600 text-white text-xs px-2 py-1 rounded tracking-tighter">v2.0</span>
                                </h1>
                                <p className="text-slate-500 font-medium">Session Tracking</p>
                            </div>
                            <div className="flex items-center gap-2">
                                <div className="hidden md:flex bg-white rounded-xl shadow-sm p-1 border border-slate-200 mr-2">
                                    {['dashboard', 'machines', 'history'].map(tab => (
                                        <button key={tab} onClick={() => setActiveTab(tab)} className={`px-4 py-2 rounded-lg text-sm font-bold capitalize transition ${activeTab === tab ? 'bg-indigo-600 text-white' : 'text-slate-500 hover:bg-slate-50'}`}>{tab}</button>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {activeTab === 'dashboard' && (
                            <div className="space-y-6">
                                {/* Date Filter */}
                                <div className="bg-white p-4 rounded-2xl shadow-sm border border-slate-200 flex flex-wrap items-center gap-4">
                                    <div className="flex items-center gap-2 text-slate-500">
                                        <Icon name="Filter" size={16} />
                                        <span className="text-xs font-black uppercase tracking-widest">Filter Data</span>
                                    </div>
                                    <input 
                                        type="date" 
                                        className="bg-slate-50 border border-slate-200 rounded-lg px-3 py-1.5 text-sm font-bold outline-none focus:ring-2 focus:ring-indigo-500"
                                        value={filterDate}
                                        onChange={(e) => setFilterDate(e.target.value)}
                                    />
                                    {filterDate && (
                                        <button 
                                            onClick={() => setFilterDate('')}
                                            className="text-xs font-bold text-indigo-600 hover:underline"
                                        >
                                            Clear Filter
                                        </button>
                                    )}
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                                        <p className="text-slate-400 text-xs font-black uppercase tracking-widest mb-1">Total Bets</p>
                                        <p className="text-3xl font-black text-slate-800">${stats.totalPlayed.toFixed(2)}</p>
                                    </div>
                                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                                        <p className="text-slate-400 text-xs font-black uppercase tracking-widest mb-1">Total Jackpots</p>
                                        <p className="text-3xl font-black text-emerald-500">${stats.totalJackpots.toFixed(2)}</p>
                                    </div>
                                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                                        <p className="text-slate-400 text-xs font-black uppercase tracking-widest mb-1">Avg Jackpot</p>
                                        <p className="text-3xl font-black text-indigo-600">${stats.avgJackpot.toFixed(2)}</p>
                                    </div>
                                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                                        <p className="text-slate-400 text-xs font-black uppercase tracking-widest mb-1">Sessions</p>
                                        <p className="text-3xl font-black text-slate-800">{stats.totalEntries}</p>
                                    </div>
                                </div>

                                <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                                    <h2 className="text-xl font-black mb-6 flex items-center gap-2 text-slate-800">
                                        <Icon name="BarChart3" className="text-indigo-600" /> Jackpots Time-Series
                                        <span className="text-xs font-bold text-slate-400 ml-auto">
                                            {filterDate ? `Viewing: ${filterDate}` : 'All Time'}
                                        </span>
                                    </h2>
                                    <div className="chart-container">
                                        <canvas ref={chartRef}></canvas>
                                    </div>
                                </div>

                                <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                                    <h2 className="text-xl font-black mb-6 flex items-center gap-2 text-slate-800">
                                        <Icon name="PlusCircle" className="text-indigo-600" /> Log Session
                                    </h2>
                                    <form onSubmit={addRecord} className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        <div className="space-y-1">
                                            <label className="text-[10px] font-black uppercase text-slate-400 ml-1">Machine</label>
                                            <select className="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 font-bold text-slate-700 outline-none" value={recordForm.machineId} onChange={(e) => setRecordForm({...recordForm, machineId: e.target.value})} required>
                                                <option value="">Choose Machine...</option>
                                                {machines.map(m => <option key={m.id} value={m.id}>{m.name}</option>)}
                                            </select>
                                        </div>
                                        <div className="space-y-1">
                                            <label className="text-[10px] font-black uppercase text-slate-400 ml-1">Day</label>
                                            <select className="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 font-bold text-slate-700 outline-none" value={recordForm.day} onChange={(e) => setRecordForm({...recordForm, day: e.target.value})}>
                                                {DAYS.map(d => <option key={d} value={d}>{d}</option>)}
                                            </select>
                                        </div>
                                        <div className="space-y-1">
                                            <label className="text-[10px] font-black uppercase text-slate-400 ml-1">Date/Time</label>
                                            <input type="datetime-local" className="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 font-bold text-slate-700 outline-none" value={recordForm.payoutTime} onChange={(e) => setRecordForm({...recordForm, payoutTime: e.target.value})} />
                                        </div>
                                        <div className="space-y-1">
                                            <label className="text-[10px] font-black uppercase text-slate-400 ml-1">Total Bet ($)</label>
                                            <input type="number" step="0.01" placeholder="0.00" className="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 font-bold text-slate-700 outline-none" value={recordForm.totalBet} onChange={(e) => setRecordForm({...recordForm, totalBet: e.target.value})} required />
                                        </div>
                                        <div className="space-y-1">
                                            <label className="text-[10px] font-black uppercase text-slate-400 ml-1">Denomination</label>
                                            <select className="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 font-bold text-slate-700 outline-none" value={recordForm.denom} onChange={(e) => setRecordForm({...recordForm, denom: e.target.value})}>
                                                {DENOMS.map(d => <option key={d} value={d}>{d}</option>)}
                                            </select>
                                        </div>
                                        <div className="space-y-1">
                                            <label className="text-[10px] font-black uppercase text-slate-400 ml-1">Multiplier</label>
                                            <select className="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 font-bold text-slate-700 outline-none" value={recordForm.multiplier} onChange={(e) => setRecordForm({...recordForm, multiplier: e.target.value})}>
                                                {MULTIPLIERS.map(m => <option key={m} value={m}>{m}x</option>)}
                                            </select>
                                        </div>
                                        <div className="space-y-1 lg:col-span-2">
                                            <label className="text-[10px] font-black uppercase text-slate-400 ml-1">Jackpot ($)</label>
                                            <input type="number" step="0.01" placeholder="0.00" className="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 font-bold text-slate-700 outline-none" value={recordForm.jackpot} onChange={(e) => setRecordForm({...recordForm, jackpot: e.target.value})} />
                                        </div>
                                        <div className="flex items-end">
                                            <button type="submit" className="w-full bg-indigo-600 text-white font-black py-3 rounded-xl shadow-lg hover:bg-indigo-700 transition active:scale-95">Save Record</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        )}

                        {activeTab === 'machines' && (
                            <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                                <div className="lg:col-span-4">
                                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                                        <h2 className="text-xl font-black mb-6 text-slate-800">Create Machine</h2>
                                        <form onSubmit={addMachine} className="space-y-4">
                                            <input placeholder="Machine Name" className="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 font-bold outline-none" value={machineForm.name} onChange={e => setMachineForm({...machineForm, name: e.target.value})} required />
                                            <input placeholder="Location" className="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 font-bold outline-none" value={machineForm.location} onChange={e => setMachineForm({...machineForm, location: e.target.value})} />
                                            <button className="w-full bg-slate-900 text-white font-black py-4 rounded-2xl hover:bg-black transition">Register</button>
                                        </form>
                                    </div>
                                </div>
                                <div className="lg:col-span-8 grid grid-cols-1 md:grid-cols-2 gap-4">
                                    {machines.map(m => (
                                        <div key={m.id} className="bg-white p-6 rounded-3xl border border-slate-200 flex justify-between items-start">
                                            <div>
                                                <h3 className="font-black text-lg text-slate-800">{m.name}</h3>
                                                <p className="text-slate-400 text-sm font-bold flex items-center gap-1 mt-1"><Icon name="MapPin" size={14}/> {m.location || 'No Location'}</p>
                                            </div>
                                            <button onClick={() => deleteMachine(m.id)} className="text-slate-200 hover:text-rose-500 transition"><Icon name="Trash2" /></button>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'history' && (
                            <div className="space-y-4">
                                <div className="flex justify-end">
                                    <button onClick={clearAllRecords} className="bg-rose-50 text-rose-600 px-4 py-2 rounded-xl text-xs font-black border border-rose-100 hover:bg-rose-100 transition">Clear All History</button>
                                </div>
                                <div className="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden">
                                    <div className="overflow-x-auto">
                                        <table className="w-full">
                                            <thead className="bg-slate-50 border-b border-slate-100">
                                                <tr>
                                                    <th className="text-left px-6 py-5 text-xs font-black text-slate-400 uppercase tracking-widest">Session</th>
                                                    <th className="text-left px-6 py-5 text-xs font-black text-slate-400 uppercase tracking-widest">Machine</th>
                                                    <th className="text-left px-6 py-5 text-xs font-black text-slate-400 uppercase tracking-widest">Config</th>
                                                    <th className="text-right px-6 py-5 text-xs font-black text-slate-400 uppercase tracking-widest">Bet/Jackpot</th>
                                                    <th className="px-6 py-5"></th>
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-50">
                                                {records.map(r => (
                                                    <tr key={r.id} className="hover:bg-slate-50 transition">
                                                        <td className="px-6 py-4">
                                                            <div className="text-sm font-black text-slate-800">{r.day}</div>
                                                            <div className="text-[10px] text-slate-400 font-bold uppercase">{r.displayDate} @ {r.displayTime}</div>
                                                        </td>
                                                        <td className="px-6 py-4 font-black text-slate-800">{r.machineName}</td>
                                                        <td className="px-6 py-4">
                                                            <div className="text-xs font-bold text-slate-600">D: {r.denom} | M: {r.multiplier}x</div>
                                                        </td>
                                                        <td className="px-6 py-4 text-right">
                                                            <div className="text-[10px] font-bold text-slate-400">BET: ${r.totalBet.toFixed(2)}</div>
                                                            <div className="text-sm font-black text-emerald-500">JACKPOT: ${r.jackpot.toFixed(2)}</div>
                                                        </td>
                                                        <td className="px-6 py-4 text-right">
                                                            <button onClick={() => deleteRecord(r.id)} className="text-slate-200 hover:text-rose-500 transition"><Icon name="Trash2" size={18} /></button>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
